function l(t,e,r){return Math.min(r,Math.max(t,e))}function s(t,e,r){return t-=e,r-=e,t<0&&(t=t%r+r),t>=r&&(t=t%r),t+e}function h(t){return typeof t=="object"&&t!==null}function g(t){return Array&&Array.isArray?Array.isArray(t):Object.prototype.toString.call(t)==="[object Array]"}function y(t){return typeof t=="function"}function u(t){let e;g(t)?e=[]:e={};for(let[r,n]of Object.entries(t))h(n)?e[r]=u(n):e[r]=n;return e}function c(t,e,r){return t-=e,r-=e,t<0&&(t=t%r+r),t>=r&&(t=t%r),t+e}function x(t,e){let r=new Array(t);if(y(e))for(let n=0;n<t;n++)r[n]=e(n);else if(h(e))for(let n=0;n<t;n++)r[n]=u(e);else if(g(e))for(let n=0;n<t;n++)r[n]=u(e);else if(typeof e<"u")for(let n=0;n<t;n++)r[n]=e;return r}var o=class{constructor(t){this.width=0,this.height=0,this.data=[],Object.assign(this,t||{})}};o.prototype.init=function(){return this.data=x(this.width*this.height,null),this};o.prototype.getIndex=function(t,e){return t=c(t,0,this.width),e=c(e,0,this.height),e*this.width+t};o.prototype.getValue=function(t,e){return this.data[this.getIndex(t,e)]};o.prototype.setValue=function(t,e,r){return this.data[this.getIndex(t,e)]=r,this};o.prototype.getRow=function(t){let e=[];for(let r=0;r<this.width;r++)e.push(this.getValue(r,t));return e};o.prototype.getColumn=function(t){let e=[];for(let r=0;r<this.height;r++)e.push(this.getValue(t,r));return e};o.prototype.toObject=function(){return u({width:this.width,height:this.height,data:this.data})};function m(t){return URL.createObjectURL(t)}function p(t){return typeof t=="object"?t:{isLoaded:!1,isRendered:!1,src:t}}function b(t){return typeof t=="string"?t:t.src}function A(t){return new Promise(function(e,r){fetch(t).then(function(n){return n.blob()}).then(function(n){e(n)}).catch(function(n){r(n)})})}function $(t){return new Promise(function(e,r){let n=new Image;n.onload=function(){e(n)},n.onerror=function(){r(new Error(`Image could not be loaded: ${t}`))},n.src=t})}var i=class extends o{constructor(e){super(e);let r=this,n={x:0,y:0,enableHorizontalLoop:!0,enableVerticalLoop:!0},d=Object.keys(n).reduce((f,a)=>(typeof r[a]<"u"&&(f[a]=r[a]),f),{});Object.assign(this,n,d),this.data=this.data.map(p)}};i.prototype.loadImage=async function(t){return t.isLoaded||(t.blob=await A(t.src),t.url=m(t.blob),t.isLoaded=!0),this};i.prototype.loadImages=async function(t){for(let e=0;e<this.data.length;e++)this.data[e]&&await this.loadImage(this.data[e]),typeof t=="function"&&t(this.data[e],e,this.data);return this};i.prototype.renderImage=async function(t){if(t.isLoaded&&!t.isRendered){if(t.element=await $(t.url),t.element.decode)try{await t.element.decode()}catch(e){console.error(e)}t.isRendered=!0}return this};i.prototype.renderImages=async function(t){for(let e=0;e<this.data.length;e++)this.data[e]&&await this.renderImage(this.data[e]),typeof t=="function"&&t(this.data[e],e,this.data);return this};i.prototype.getImage=i.prototype.getValue;i.prototype.setImage=function(t,e,r){return this.setValue(t,e,p(r))};i.prototype.getCurrentImage=function(){return this.getImage(this.x,this.y)};i.prototype.getCurrentIndex=function(){return this.getIndex(this.x,this.y)};i.prototype.move=function(t,e){return t&&(this.enableHorizontalLoop?this.x=s(this.x+t,0,this.width):this.x=l(this.x+t,0,this.width-1)),e&&(this.enableVerticalLoop?this.y=s(this.y+e,0,this.height):this.y=l(this.y+e,0,this.height-1)),this};i.prototype.export=function(){return Object.assign({},this,{data:this.data.map(b)})};export{i as ObjectView};
