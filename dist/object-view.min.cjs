"use strict";var s=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var b=Object.prototype.hasOwnProperty;var A=(t,e)=>{for(var r in e)s(t,r,{get:e[r],enumerable:!0})},$=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let u of m(e))!b.call(t,u)&&u!==r&&s(t,u,{get:()=>e[u],enumerable:!(n=x(e,u))||n.enumerable});return t};var O=t=>$(s({},"__esModule",{value:!0}),t);var E={};A(E,{ObjectView:()=>i});module.exports=O(E);function f(t,e,r){return Math.min(r,Math.max(t,e))}function c(t,e,r){return t-=e,r-=e,t<0&&(t=t%r+r),t>=r&&(t=t%r),t+e}function p(t){return typeof t=="object"&&t!==null}function d(t){return Array&&Array.isArray?Array.isArray(t):Object.prototype.toString.call(t)==="[object Array]"}function C(t){return typeof t=="function"}function a(t){let e;d(t)?e=[]:e={};for(let[r,n]of Object.entries(t))p(n)?e[r]=a(n):e[r]=n;return e}function g(t,e,r){return t-=e,r-=e,t<0&&(t=t%r+r),t>=r&&(t=t%r),t+e}function w(t,e){let r=new Array(t);if(C(e))for(let n=0;n<t;n++)r[n]=e(n);else if(p(e))for(let n=0;n<t;n++)r[n]=a(e);else if(d(e))for(let n=0;n<t;n++)r[n]=a(e);else if(typeof e<"u")for(let n=0;n<t;n++)r[n]=e;return r}var o=class{constructor(t){this.width=0,this.height=0,this.data=[],Object.assign(this,t||{})}};o.prototype.init=function(){return this.data=w(this.width*this.height,null),this};o.prototype.getIndex=function(t,e){return t=g(t,0,this.width),e=g(e,0,this.height),e*this.width+t};o.prototype.getValue=function(t,e){return this.data[this.getIndex(t,e)]};o.prototype.setValue=function(t,e,r){return this.data[this.getIndex(t,e)]=r,this};o.prototype.getRow=function(t){let e=[];for(let r=0;r<this.width;r++)e.push(this.getValue(r,t));return e};o.prototype.getColumn=function(t){let e=[];for(let r=0;r<this.height;r++)e.push(this.getValue(t,r));return e};o.prototype.toObject=function(){return a({width:this.width,height:this.height,data:this.data})};function j(t){return URL.createObjectURL(t)}function y(t){return typeof t=="object"?t:{isLoaded:!1,isRendered:!1,src:t}}function I(t){return typeof t=="string"?t:t.src}function S(t){return new Promise(function(e,r){fetch(t).then(function(n){return n.blob()}).then(function(n){e(n)}).catch(function(n){r(n)})})}function T(t){return new Promise(function(e,r){let n=new Image;n.onload=function(){e(n)},n.onerror=function(){r(new Error(`Image could not be loaded: ${t}`))},n.src=t})}var i=class extends o{constructor(e){super(e);let r=this,n={x:0,y:0,enableHorizontalLoop:!0,enableVerticalLoop:!0},u=Object.keys(n).reduce((h,l)=>(typeof r[l]<"u"&&(h[l]=r[l]),h),{});Object.assign(this,n,u),this.data=this.data.map(y)}};i.prototype.loadImage=async function(t){return t.isLoaded||(t.blob=await S(t.src),t.url=j(t.blob),t.isLoaded=!0),this};i.prototype.loadImages=async function(t){for(let e=0;e<this.data.length;e++)this.data[e]&&await this.loadImage(this.data[e]),typeof t=="function"&&t(this.data[e],e,this.data);return this};i.prototype.renderImage=async function(t){if(t.isLoaded&&!t.isRendered){if(t.element=await T(t.url),t.element.decode)try{await t.element.decode()}catch(e){console.error(e)}t.isRendered=!0}return this};i.prototype.renderImages=async function(t){for(let e=0;e<this.data.length;e++)this.data[e]&&await this.renderImage(this.data[e]),typeof t=="function"&&t(this.data[e],e,this.data);return this};i.prototype.getImage=i.prototype.getValue;i.prototype.setImage=function(t,e,r){return this.setValue(t,e,y(r))};i.prototype.getCurrentImage=function(){return this.getImage(this.x,this.y)};i.prototype.getCurrentIndex=function(){return this.getIndex(this.x,this.y)};i.prototype.move=function(t,e){return t&&(this.enableHorizontalLoop?this.x=c(this.x+t,0,this.width):this.x=f(this.x+t,0,this.width-1)),e&&(this.enableVerticalLoop?this.y=c(this.y+e,0,this.height):this.y=f(this.y+e,0,this.height-1)),this};i.prototype.export=function(){return Object.assign({},this,{data:this.data.map(I)})};0&&(module.exports={ObjectView});
